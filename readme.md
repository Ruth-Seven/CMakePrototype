

# CMake Prototype 
è¿™ä¸ªé¡¹ç›®æ˜¯ä¸ºäº†è®°å½•ä¸€ç‚¹ç‚¹å­¦ä¹ `cmake`åŽçš„èµ„æ–™å’Œå®žè·µç»“æžœçš„ï¼Œç¬”è®°ç”±äºŽä¸æˆä½“ç³»ï¼Œè€Œä¸”`cmake`éš¾åº¦ä¸»è¦åœ¨äºŽç†è§£ç¼–è¯‘è¿‡ç¨‹ï¼Œå°±ä¸æ”¾äº†ã€‚é‡è¦çš„æ˜¯ç»™å‡ºå­¦ä¹ æ–¹å‘ï¼ŒèŠ‚çœæ—¶é—´ã€‚

# What is Cmake?

Cmakeæ˜¯è·¨ç³»ç»Ÿï¼ŒC++çŽ°è¡Œæ ‡å‡†æž„å»ºæ ‡å‡†çš„build system of build systemã€‚å­¦ä¹ CMakeéœ€è¦ä¸€ç‚¹ç‚¹è€å¿ƒï¼Œå› ä¸ºCMakeéœ€è¦ä½ é¦–å…ˆæœ‰æ“ä½œç³»ç»Ÿå¦‚ä½•ç¼–è¯‘æ–‡ä»¶çš„å‰æçŸ¥è¯†ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥ç›´æŽ¥è·³è¿‡è¿™ä¸ªéƒ¨åˆ†ï¼Œæ‰‹æŠŠæ‰‹çœ‹`cmake`ä»£ç ï¼Œé©¬ä¸Šä¸Šæ‰‹é¡¹ç›®ã€‚ä½†æ˜¯å‰è€…è¿½æ±‚æ˜¯ç¨‹åºå‘˜çš„ç†è§£ï¼ŒåŠŸå¤«æ›´æ·±æ›´æ‰Žå®žã€‚

# How to understand and use CMake?
ä»¥ä¸‹æ˜¯æˆ‘ç¿»é˜…çš„ä¸€äº›`cmake`æœ‰è¶£å®žç”¨çš„èµ„æ–™ï¼ŒæŒ‰é€‚å®œå®žç”¨é¡ºåºæŽ’åˆ—ï¼š

- [Cmake Tutorial](https://medium.com/@onur.dundar1/cmake-tutorial-585dd180109b): ðŸ’–ä»Žé›¶åŸºç¡€è§£é‡ŠCMakeåŸºç¡€æ¦‚å¿µ
- [modern-cmake](https://cliutils.gitlab.io/modern-cmake/chapters/intro/newcmake.html) âœ…: æœ€è¯¦ç»†ï¼Œæœ‰å¾ˆå¤šé¡¹ç›®ç»éªŒï¼Œæœ¬èº«ä¹Ÿæœ‰ç€å‡ ä¸ªè¯¦ç»†çš„å°CMakeé¡¹ç›®ä¾‹å­
- [Original cmake tutorial](https://cmake.org/cmake/help/latest/guide/tutorial/index.html) âœ… ï¼š`CMake`å®˜æ–¹å‡ºçš„è·Ÿç€åšæ¯”è¾ƒæœ‰æ„æ€ï¼Œå¯ä»¥å¤šå¤šå°è¯•ï¼Œå°±æ˜¯æœ‰ç‚¹èŠ±æ—¶é—´ã€‚åŽé¢éƒ¨åˆ†å†…å®¹å¯ä»¥çœ‹çœ‹

çº¸ä¸Šå¾—æ¥ç»ˆè§‰æµ…ï¼Œç»çŸ¥æ­¤äº‹è¦èº¬è¡Œã€‚


# æµ‹è¯•æ¡†æž¶å®žè·µ
åœ¨é˜…è¯»äº†GoogleTestæµ‹è¯•æ¡†æž¶æºä»£ç åŽï¼Œæˆ‘ä¹Ÿæ’¸äº†ä¸€ä¸ªçŽ©å…·æ€§è´¨çš„æµ‹è¯•æ¡†æž¶ã€‚è¿è¡Œåªéœ€è¦å¯¼å…¥`jtest.hpp`ï¼Œè¿›è¡Œé…ç½®å³å¯ï¼š
```c++
#include "add.hxx"
// å•å…ƒæµ‹è¯•æ ·ä¾‹
TEST(HelloTest1, ADD1){
    //LOG("test1")
	EXPECT_EQ(ADD1(3,4), 7);
	EXPECT_NE(ADD1(3,4), 6);
	EXPECT_LT(ADD1(3,4), 8);
	EXPECT_LE(ADD1(3,4), 7);
	EXPECT_GT(ADD1(3,4), 6);
	EXPECT_GE(ADD1(3,4), 7);
}

int main(){
	return RUN_ALL_TESTS();
}
```
> ç›®å‰æ”¯æŒå…­ä¸ªæ•°å€¼åˆ¤æ–­é€»è¾‘æµ‹è¯•ã€‚


é¡¹ç›®ä¸­`test.cpp`è¿è¡Œç»“æžœå¦‚ä¸‹ï¼š

![image-20210505103408361](http://static.come2rss.xyz/image-20210505103408361.png)


åœ¨ç”¨`cmake`ç¼–è¯‘é“¾æŽ¥ï¼Œå¯åœ¨`./build/test`ä¸‹è¿è¡Œæµ‹è¯•`target`äºŒè¿›åˆ¶æ–‡ä»¶ã€‚

## ä¸»è¦åŽŸç†
åˆ©ç”¨C++/å®è¿›è¡Œ`TEST`åŠŸèƒ½çš„å®æ›¿æ¢ï¼Œå®žçŽ°è‡ªåŠ¨å‡½æ•°å®šä¹‰ï¼Œæµ‹è¯•å•å…ƒä¿¡æ¯æ³¨å†Œå’Œé”€æ¯ã€‚
åŒæ—¶è¾“å‡ºé²œæ˜Žçš„åˆ¤æ–­ä¿¡æ¯ï¼Œæ¯”å¦‚é¢œè‰²ï¼Œæ–‡ä»¶å’Œè¡Œæ•°å¸®åŠ©ç»“æžœæŸ¥çœ‹ã€‚


## æŠ€æœ¯å¡ç‚¹
- å®æ›¿æ¢ï¼šå¤šè¡Œå®æ›¿æ¢ï¼Œå®å‚æ•°çš„å­—ç¬¦ä¸²åŒ–å’Œè¿žæŽ¥ï¼Œä¸­é—´å±‚å®ç¼–å†™
- å®è°ƒè¯•åŠŸèƒ½éœ€è¦å¾ˆå¤šç»éªŒ
- æ³¨å†Œå‡½æ•°ã€æ³¨é”€å‡½æ•°
- printfé¢œè‰²æŽ§åˆ¶
- å•å…ƒæµ‹è¯•æ–¹æ³•ä¿¡æ¯æ³¨å†Œå®žçŽ°æ–¹æ³•ï¼Œå®žçŽ°æ•°æ®ç»“æž„ï¼ŒåŠ¨æ€èµ„æºç®¡ç†
- å¤šæ–‡ä»¶æ•°æ®å…±äº«ç¼–ç ï¼ˆC++å¤–éƒ¨é“¾æŽ¥é—®é¢˜ï¼‰

## è¿è¡Œ

ç¼–è¯‘
```shell
rm build -rf
cmake -S . -B build -D BUILD_TESTS=1 
cmake --build build  
```
> `BUILD_TESTS`ï¼š `cmake`è¿›è¡Œæµ‹è¯•ç›¸å…³æž„å»º

ä½¿ç”¨è‡ªå®šä¹‰æµ‹è¯•æ¡†æž¶ï¼š
```shell
./build/test/maintest
```
è¿è¡Œä¸»ç¨‹åºï¼š
```shell
./build/apps/app
```
è‡ªå®šä¹‰æµ‹è¯•ï¼š
```shell
 cmake -S . -B build -D BUILD_TESTS=1 -D USE_LOG=1 && cmake --build build  && ./build/test/maintest
 ```
 > `BUILD_TESTS`: æž„å»ºæµ‹è¯•
 > `USE_LOG1`ï¼šå¿½ç•¥æµ‹è¯•LOGåŠŸèƒ½

